import telebot
from telebot import types

TOKEN = '7721932002:AAF6yxd2CEEK5XXl7pSsJHmTFkcLbp7shUM'
bot = telebot.TeleBot(TOKEN)

user_data = {}
registered_users = set()

# Ø³ÙˆØ§Ù„Ø§Øª Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
questions = ["Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",
             "Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒØŸ",
             "Ø³Ù†ØŸ",
             "Ø§Ø³ØªØ§Ù†ØŸ",
             "Ø´Ù‡Ø±ØŸ",
             "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ØŸ"]

@bot.message_handler(commands=['start'])
def start(message):
    user_data[message.chat.id] = {'step': 0, 'answers': []}
    bot.send_message(message.chat.id, questions[0])

@bot.message_handler(func=lambda message: message.chat.id in user_data)
def collect_info(message):
    chat_id = message.chat.id
    data = user_data[chat_id]
    data['answers'].append(message.text)
    data['step'] += 1

    if data['step'] < len(questions):
        bot.send_message(chat_id, questions[data['step']])
    else:
        registered_users.add(chat_id)
        bot.send_message(chat_id, "Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ù…Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯ âœ…")
        send_main_menu(chat_id)
        del user_data[chat_id]

def send_main_menu(chat_id):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    buttons = [
        "ğŸ“š Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§", "ğŸ›ï¸ ÙØ±ÙˆØ´Ú¯Ø§Ù‡", "ğŸ’³ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ù‡Ø±ÛŒÙ‡",
        "â„¹ï¸ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§", "ğŸ¤ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø§ Ù…Ø§", "ğŸ“ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ",
        "ğŸ¥ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ", "ğŸŒ ÙˆØ¨ÛŒÙ†Ø§Ø±Ù‡Ø§", "ğŸ“ Ø¢Ø²Ù…ÙˆÙ†"
    ]
    for i in range(0, len(buttons), 2):
        row = buttons[i:i+2]
        markup.add(*row)
    bot.send_message(chat_id, "Ø§Ø² Ù…Ù†ÙˆÛŒ Ø²ÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:", reply_markup=markup)

# Ø¯Ú©Ù…Ù‡ Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§
@bot.message_handler(func=lambda message: message.text == "ğŸ“š Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§")
def courses_handler(message):
    if message.chat.id not in registered_users:
        return bot.send_message(message.chat.id, "Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯.")

    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton("Ø«Ø¨Øª Ù†Ø§Ù… Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ø³Ø·Ø­", callback_data="assessment"))
    with open("/mnt/data/photo_6019563271876626764_y.jpg", 'rb') as photo:
        bot.send_photo(message.chat.id, photo, caption="Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§ ğŸ‘‡", reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data == "assessment")
def assessment_callback(call):
    bot.send_message(call.message.chat.id, "Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø¨Ø§ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ø³Ø·Ø­ ØªÙ…Ø§Ø³ Ú¯Ø±ÙØªÙ‡ Ù…ÛŒØ´ÙˆØ¯.")

# Ø¯Ú©Ù…Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡
@bot.message_handler(func=lambda message: message.text == "ğŸ›ï¸ ÙØ±ÙˆØ´Ú¯Ø§Ù‡")
def store_handler(message):
    if message.chat.id not in registered_users:
        return bot.send_message(message.chat.id, "Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯.")
    
    books = [
        "ğŸ“˜ Family and Friends 1 - 150 Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†",
        "ğŸ“— Family and Friends 2 - 150 Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†",
        "ğŸ“˜ Family and Friends 3 - 150 Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†",
        "ğŸ“— Family and Friends 4 - 150 Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†",
        "ğŸ“˜ Family and Friends 5 - 150 Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†",
        "ğŸ“— Family and Friends 6 - 150 Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†"
    ]
    for book in books:
        bot.send_message(message.chat.id, book)

# Ø³Ø§ÛŒØ± Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ ÙØ¹Ù„Ø§Ù‹ ÙÙ‚Ø· Ù¾ÛŒØ§Ù… Ù…ÛŒØ¯Ù†
@bot.message_handler(func=lambda message: message.text in [
    "ğŸ’³ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ù‡Ø±ÛŒÙ‡", "â„¹ï¸ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§", "ğŸ¤ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø§ Ù…Ø§",
    "ğŸ“ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ", "ğŸ¥ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ", "ğŸŒ ÙˆØ¨ÛŒÙ†Ø§Ø±Ù‡Ø§", "ğŸ“ Ø¢Ø²Ù…ÙˆÙ†"])
def others_handler(message):
    if message.chat.id not in registered_users:
        return bot.send_message(message.chat.id, "Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯.")
    
    bot.send_message(message.chat.id, f"Ø¨Ø®Ø´ {message.text} Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.")

# Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª
bot.infinity_polling()